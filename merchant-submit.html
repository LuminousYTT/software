<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>商户提交商品</title>
	<link rel="stylesheet" href="style.css" />
</head>

<body>
	<main class="container" style="padding: 2rem 0; max-width: 720px;">
		<h1 class="section-title">商户商品管理</h1>
		<p style="margin-bottom: 1rem; color: #555;">已登录商户可提交上架或下架申请，管理员审核后生效。</p>
		<div class="card" style="margin-bottom:1rem;">
			<h3>提交上架申请</h3>
			<form id="merchant-form">
				<div class="form-group">
					<label for="gname">商品名称</label>
					<input id="gname" name="gname" type="text" placeholder="例如：咖啡券" required />
				</div>
				<div class="form-row">
					<div class="form-group">
						<label for="gcount">数量</label>
						<input id="gcount" name="gcount" type="number" min="1" step="1" placeholder="10" required />
					</div>
					<div class="form-group">
						<label for="gvalue">价值（积分）</label>
						<input id="gvalue" name="gvalue" type="number" min="1" step="1" placeholder="100" required />
					</div>
				</div>
				<button type="submit">提交上架申请</button>
				<div id="merchant-tip" class="empty-tip hidden">提交成功，等待管理员审核。</div>
			</form>
		</div>

		<div class="card">
			<h3>提交下架申请</h3>
			<form id="offline-form">
				<div class="form-group">
					<label for="gid">商品ID</label>
					<input id="gid" name="gid" type="number" min="1" step="1" placeholder="请输入已上架商品ID" required />
				</div>
				<button type="submit">提交下架申请</button>
				<div id="offline-tip" class="empty-tip hidden">已提交下架申请，等待审核。</div>
			</form>
		</div>
	</main>

	<script>
		const API_BASE = 'http://127.0.0.1:5000/api';
		const token = localStorage.getItem('merchant_token');
		if (!token) {
			window.location.href = 'merchant-auth.html';
		}

		const form = document.getElementById('merchant-form');
		const tip = document.getElementById('merchant-tip');
		const offlineForm = document.getElementById('offline-form');
		const offlineTip = document.getElementById('offline-tip');

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			const payload = {
				name: document.getElementById('gname').value.trim(),
				count: Number(document.getElementById('gcount').value),
				value: Number(document.getElementById('gvalue').value)
			};
			try {
				const res = await fetch(`${API_BASE}/merchant/submit`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
					body: JSON.stringify(payload)
				});
				const data = await res.json();
				if (!res.ok) throw new Error(data.error || '提交失败');
				tip.textContent = '提交成功，等待管理员审核。';
				tip.classList.remove('hidden');
				form.reset();
			} catch (err) {
				tip.textContent = err.message || '提交失败';
				tip.classList.remove('hidden');
			}
		});

		offlineForm.addEventListener('submit', async (e) => {
			e.preventDefault();
			const payload = { gid: Number(document.getElementById('gid').value) };
			try {
				const res = await fetch(`${API_BASE}/merchant/offline`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
					body: JSON.stringify(payload)
				});
				const data = await res.json();
				if (!res.ok) throw new Error(data.error || '提交失败');
				offlineTip.textContent = '已提交下架申请，等待审核。';
				offlineTip.classList.remove('hidden');
				offlineForm.reset();
			} catch (err) {
				offlineTip.textContent = err.message || '提交失败';
				offlineTip.classList.remove('hidden');
			}
		});
	</script>
</body>

</html>